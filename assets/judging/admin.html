<!DOCTYPE html>

<head>
    <title>2025 BeastSaber Mapping Awards Submission Form</title>
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="style.css" rel="stylesheet">!-->
    <link href="/judging/style.css" rel="stylesheet">

</head>

<body style="background-color: black;">
    <nav>
        <a class="nav" href="/judging">Home</a>
        <a class="nav" href="/judging/sort">Sort Submissions</a>
        <a class="nav" href="/judging/judge">Judge Submissions</a>
        <a class="nav" href="/api/counts">Counts (API)</a>
        <a class="nav active" href="/judging/admin">Admin</a>
        <a class="nav" id="login" href="/api/auth/discord">Login</a>
    </nav>
    <div class="header">
        <h1>2024 BeastSaber Mapping Awards</h1>
    </div>
    <div class="header">
        <h2>Admin Panel</h2>
        <p>Various Admin tools that realistcally should've been the first things i added.</p>
        <p style="color: red; font-weight: 900;">DO NOT TOUCH ANYTHING IF YOU DON'T KNOW EXACTLY WHAT IT DOES. THIS PAGE CAN AND WILL AND HAS BROKEN THINGS.<br><br>ASSUME THERE ARE NO BACKUPS.</p>
    </div>
    <div class="header-row">
        <div class="header">
            <h2>One Shot</h2>
            <h3>updateNullValues</h3>
            <p>Goes through all submissions and sorted submissions, and updates any null values (such as hash or mappers) to their defaults. Only runs on maps with a missing hash.</p>
            <button id="updateNullValues">updateNullValues</button>
            <h3>runInvolvedCheck</h3>
            <p>Goes through all submissions and sorted submissions, and checks if any users involved with the submission (mappers, contributors, etc) have judging roles. If they do, it automatically votes "involved" for them if they haven't already voted.</p>
            <button id="runInvolvedCheck">runInvolvedCheck</button>
            <h3>checkDuplicateVotes</h3>
            <p>Checks for any votes that have been duplicated & reports them. They are not automatically fixed.</p>
            <button id="checkDuplicateVotes">checkDuplicateVotes</button>
        </div>
        <div class="header">
            <h2>Per Category</h2>
            <p>These below actions will only apply to the selected category.</p>
            <select id="category1" placeholder="Category"></select>
            <p>Adds maps that have been marked as accepts but are not in the sortedSubmissions table.</p>
            <button id="repopulateSortedSubmissions">repopulateSortedSubmissions</button>
            <h3>Cut Submissions</h3>
            <p>Two Cutting Methods: The endpoint has two primary ways to "cut" submissions:<br>
            By Amount: If an amount is provided, the endpoint sorts all submissions in the category by their total vote score in descending order. It then removes all submissions that fall outside the top amount. For example, if amount is 10, it keeps the top 10 and deletes the rest.<br>
            By "No" Vote Threshold: If a noThreshold is provided, the endpoint goes through each submission and counts how many judges gave it a "no" vote (a score of 0). If a submission has received a number of "no" votes equal to or greater than the noThreshold, it is removed.<br>
            Fake Run: The fakeRun boolean parameter is a safety feature. If set to true, the endpoint will perform all the calculations and identify which submissions would be cut, but it won't actually delete them from the database. This allows for a "dry run" to see the impact of a cut before committing to it.</p>
            <input type="text" id="amount" placeholder="amount to keep">
            <input type="text" id="noThreshold" placeholder="amount of nos">
            <input type="checkbox" id="fakeRun" name="fakeRun" checked />
            <label for="fakeRun">fakeRun</label>
            <button id="cutSubmissions">cutSubmissions</button>
            <h3>Reset Votes</h3>
            <p>Resets all "yes" votes for a specific user in the selected category.</p>
            <input type="text" id="userIdToRun" placeholder="userIdToRun">
            <button id="resetCategoryVotes">resetCategoryVotes</button>
            <h3>Get Final Votes</h3>
            <p>Generates a file with all of the final vote data for the judges to decide upon.</p>
            <button id="getFinalVotes">getFinalVotes</button>
            <div class="header-row">
                <input type="checkbox" id="total" name="total" checked />
                <label for="total">Total Votes</label>
                <input type="checkbox" id="adjusted" name="adjusted" checked />
                <label for="adjusted">Adjusted Total Votes</label>
            </div>
        </div>
    </div>
    <div class="header" style="max-width: none;">
        <h2>Active Database Entry</h2>
        <table id="activeTable"></table>
    </div>
    <div class="header-row">
        <div class="header">
            <h2>Per Submission</h2>
            <input type="text" id="submissionId" placeholder="Submission ID">
            <div class="header-row">
                <button id="loadSubmission">Load</button>
                <button id="deleteSubmission">Delete</button>
            </div>
            <input type="text" id="submissionBsr" placeholder="Submission BSR (d00c)">
            <div class="header-row">
                <button id="loadSubmissionBsr">Search</button>
            </div>
        </div>
        <div class="header">
            <h2>Per SortedSubmission</h2>
            <input type="text" id="sortedSubmissionId" placeholder="Sorted Submission ID">
            <div class="header-row">
                <button id="loadSortedSubmission">Load</button>
                <button id="deleteSortedSubmission">Delete</button>
            </div>
            <select id="category3" placeholder="Category"></select>
            <div class="header-row">
                <button id="recategorizeSortedSubmission">Change Category</button>
            </div>
            <input type="text" id="sortedSubmissionBsr" placeholder="Sorted Submission Bsr (d00c)" >
            <div class="header-row">
                <button id="loadSortedSubmissionBsr" >Search</button>
            </div>
        </div>
        <div class="header">
            <h2>Per Judge</h2>
            <input type="text" id="judgeId" placeholder="Judge ID">
            <div class="header-row">
                <button id="loadJudge">Load</button>
                <button id="deleteJudge" disabled>Delete</button>
            </div>
            <div class="header-row">
                <button id="addSortingRole">Add Sorting Role</button>
                <button id="removeSortingRole">Remove Sorting Role</button>
            </div>
            <div class="header-row">
                <button id="addJudgeRole">Add Judge Role</button>
                <button id="removeJudgeRole">Remove Judge Role</button>
            </div>
            <select id="category2" placeholder="Category"></select>
            <div class="header-row">
                <button id="addCategory">Add to Category</button>
                <button id="removeCategory">Remove from Category</button>
        </div>
    </div>
    <script src="/judging/background.js"></script>
    <script src="/judging/admin/script.js"></script>
    <script>
        fetch(`/api/auth/judging`).then(response => {
            if (response.status == 200) {
                response.json().then(data => {
                    if (data.username) {
                        document.getElementById(`login`).innerText = `Logout (${data.username})`;
                        username = data.username;
                    }
                });
            } else {
                window.location.href = `/judging`;
            }
        });
    </script>
</body>
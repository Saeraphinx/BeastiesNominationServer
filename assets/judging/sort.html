<!DOCTYPE html>

<head>
    <title>2024 BeastSaber Mapping Awards Submission Form</title>
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="style.css" rel="stylesheet">
    <link href="/judging/style.css" rel="stylesheet">

</head>

<body>
    <nav>
        <a class="nav" href="/judging">Back to Judging</a>
    </nav>
    <div class="header">
        <h1>Sort Submissions</h1>
        <button>Refresh</button>
    </div>
    <div class="submissionList" id="submissionList">
    </div>

    <script>
        fetch('https://api.beatsaver.com/maps/id/' + "3bbb0").then(response => response.json()).then(data => {
            console.log(data);
            document.getElementById("submissionList").appendChild(createBeatmap(data, "fuck3", "ExpertPlus", "Standard", true, true));
        });

        fetch('https://api.beatsaver.com/maps/id/' + "34a3d").then(response => response.json()).then(data => {
            console.log(data);
            document.getElementById("submissionList").appendChild(createBeatmap(data, "fuck 2", "Expert", "Standard", false, true));
        });

        fetch('https://api.beatsaver.com/maps/id/' + "6b55").then(response => response.json()).then(data => {
            console.log(data);
            document.getElementById("submissionList").appendChild(createBeatmap(data, "fuck", "Expert", "Standard", true, true));
        });

        // TODO: 
        // Add Diff & Char + Add Category
        function createBeatmap(bsapi, category= "you fucked up", selectedDiff = "ExpertPlus", selectedChar = "Standard", showMods = false, showRanked = false, validFullSpread = false) {
            let disabledFlag = false;
            let currDiff = bsapi.versions[0].diffs.find(diff => diff.difficulty === selectedDiff && diff.characteristic === selectedChar);

            if ((showRanked || showMods) && !currDiff) {
                showRanked = false;
                showMods = false;
                disabledFlag = true;
            }
            
            let beatmap = document.createElement("div");
            beatmap.classList.add("beatmap");

            //title
            let title = document.createElement("p");
            title.classList.add("title");
            title.innerText = `${bsapi.metadata.songName}${bsapi.metadata.songSubName ? ` ${bsapi.metadata.songSubName}` : `` } by ${bsapi.metadata.songAuthorName}`;
            title.title = title.innerText;
            if (title.innerText.length > 19) {
                title.innerText = title.innerText.substring(0, 19) + "...";
            }
            beatmap.appendChild(title);

            //subtext
            let subtext = document.createElement("p");
            subtext.classList.add("subtext");
            subtext.innerText = `!bsr ${bsapi.id}`;
            beatmap.appendChild(subtext);
            if (showMods) {
                subtext.innerText += ` | NE: ${currDiff.ne} | Chroma: ${currDiff.chroma}`;
            } else if (showRanked) {
                subtext.innerText += ` | SS: ${currDiff.stars || `N/A`}★ | BL: ${currDiff.blStars || `N/A`}★`;
                if (!currDiff.stars && !currDiff.blStars) {
                    disabledFlag = true;
                }
            } else if (validFullSpread) {
                bsapi.versions[0].diffs.find(diff => diff.difficulty === "Easy") && bsapi.versions[0].diffs.find(diff => diff.difficulty === "Normal") && bsapi.versions[0].diffs.find(diff => diff.difficulty === "Hard") && bsapi.versions[0].diffs.find(diff => diff.difficulty === "Expert") && bsapi.versions[0].diffs.find(diff => diff.difficulty === "ExpertPlus") ? subtext.innerText += ` | Full Spread` : subtext.innerText += ` | Missing Difficulties`;
                disabledFlag = true;
            } else if (disabledFlag) {
                subtext.innerText += ` | Invalid Difficulty`;
            } 

            //cover
            let cover = document.createElement("div");
            let coverImg = document.createElement("img");
            coverImg.src = bsapi.versions[0].coverURL;
            coverImg.width = 128;
            coverImg.height = 128;
            cover.appendChild(coverImg);
            beatmap.appendChild(cover);

            //mappers
            let mappers = document.createElement("div");
            mappers.classList.add("mappers");
            let mapperText = document.createElement("p");
            mapperText.innerText = "Mapper(s):";
            mapperText.classList.add("mapperText");
            mappers.appendChild(mapperText);
            let mapper = document.createElement("div");
            let mappername = document.createElement("p");
            mapper.classList.add("mapper");
            mappername.innerText = bsapi.metadata.levelAuthorName;
            let mapperimg = document.createElement("img");
            mapperimg.src =  bsapi.uploader.avatar;
            mapperimg.width = 24;
            mapperimg.height = 24;
            mapper.appendChild(mapperimg);
            mapper.appendChild(mappername);
            mappers.appendChild(mapper);
            beatmap.appendChild(mappers);

            //buttons
            let buttons = document.createElement("div");
            buttons.classList.add("actions");
            let actionsText = document.createElement("p");
            actionsText.innerText = "Actions:";
            buttons.appendChild(actionsText);
            let approveButton = document.createElement("button");
            approveButton.innerText = "Approve";
            let rejectButton = document.createElement("button");
            rejectButton.innerText = "Reject";
            if(disabledFlag) {
                //approveButton.style.display = "none";
            } else {
                approveButton.classList.add("green-glow");
            }
            rejectButton.classList.add("red-glow");
            buttons.appendChild(approveButton);
            buttons.appendChild(rejectButton);
            beatmap.appendChild(buttons);

            return beatmap;
        }

        function convertToBNS(charecteristic, difficulty) {
            let returnObj = {
                charecteristic: "",
                color: "000"
            };
            switch (charecteristic) {
                case "Standard":
                    returnObj.charecteristic = "standard";
                    break;
                case "OneSaber":
                    returnObj.charecteristic = "one-saber";
                    break;
                case "NoArrows":
                    returnObj.charecteristic = "no-arrows";
                    break;
                case "360Degree":
                    returnObj.charecteristic = "360-degree";
                    break;
                case "90Degree":
                    returnObj.charecteristic = "90-degree";
                    break;
                case "Lawless":
                    returnObj.charecteristic = "lawless";
                    break;
                case "Lightshow":
                    returnObj.charecteristic = "lightshow";
                    break;
                case "Legacy":
                    returnObj.charecteristic = "legacy";
                    break;
            }
            switch (difficulty) {
                case "Easy":
                    returnObj.color = "008055";
                    break;
                case "Normal":
                    returnObj.color = "1268a1";
                    break;
                case "Hard":
                    returnObj.color = "bd5500";
                    break;
                case "Expert":
                    returnObj.color = "b52a1c";
                    break;
                case "ExpertPlus":
                    returnObj.color = "7646af";
                    break;
            }
            return returnObj;
        }
    </script>
</body>
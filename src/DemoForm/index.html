<!DOCTYPE html>

<head>
    <title>Form</title>

    <style>
        @keyframes bg {
            0% { background-position: 0% 24% }
            50% { background-position: 100% 77% }
            100% { background-position: 0% 24% }
        }

        body {
            background-image: linear-gradient(120deg, #b52a1c -49%, #454088 27.08%, #454088 70%, #1268a1);
            background: linear-gradient(127deg, #f708d4, #4808f7, #a24aff, #8f18f7, #f708e9);
            background-size: 1000% 1000%;
            animation: bg 90s ease infinite;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 4vh;
        }

        div#info, div#form, div#countsContainer{
            margin: 10px;
            max-width: 600px;
            min-width: 250px;
            width: 80%;
            padding: 20px;
            border: 1px solid rgb(92, 4, 255);
            color: white;
            border-radius: 10px;
            background-color: black;
        }

        div#info {
            padding: 0px 20px 20px 20px;
            text-align: center;
        }

        #nominationForm {
            display: flex;
            flex-direction: column;
        }

        input[type="text"],
        select {
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid black;
        }

        input[type="submit"] {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid black;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #45a049;
        }

        h1 {
            margin-bottom: 0px;
        }

        h2 {
            text-align: center;
            margin-top: 0px;
        }

        h4 {
            margin-top: 0px;
        }

        #username, a.username, a:visited.username, a:active.username, a:hover.username{
            text-align: center;
            color: white;
            text-decoration: none;
            font-size: 12px;
            margin-bottom: 0px;
        }

        div#countsContainer {
            padding: 0px 20px 20px 20px;
            text-align: center;
        }

        div#counts {
            display: inline-flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }

        p.countLabel {
            margin: 0;
        }

        p.count {
            display: inline;
            font-size: 26px;
        }

        span {
            display: inline-block;
            margin: 10px;
            margin-bottom: 2px;
            padding: 10px;
            padding-bottom: 8px;
            border-radius: 8px;
            border: rgb(52, 52, 52) 1px solid;
        }

        footer {
            font-family: Arial, sans-serif;
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            padding: 5px;
            text-decoration: none;
            font-size: 12px;
        }

        a.footer, a:visited.footer, a:active.footer, a:hover.footer {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div id="info">
        <h1>The BeastSaber Mapping Awards</h1>
        <h4>AKA: The Beasties - By Mappers, for Mappers</h4>
        <p>The BeastSaber Mapping Awards were launched in 2021 to highlight the best of the best of the art (and science) of making custom Beat Saber maps. The first year featured 29 categories, garnered 760 nominated maps, resulting in 96 finalists, with more than 45 medals won.
        <br><br>
        Map curation is focused on maps that avoid objectively bad mapping and have a “fun factor” that appeals to a member of our curation team - the “blockbuster movies” of the custom map world. The Beasties go beyond the fun factor to dig deep into mapping theory and practices to highlight the maps that may not have grabbed the spotlight but are well-constructed and have incredible representation, emphasis, and flow to truly capture the feel of the song - the art films of the custom map world.</p>
    </div>
    <div id="form">
        <h2>2024 Map Submission Form</h2>
        <form action="form/submitmap" method="post" id="nominationForm">
            <label for="category">Category</label>
            <select id="category" name="category" onchange="onChange()"></select><br><br>
            
            <label class="FORMbsr" for="bsrId">BSR Key (e.g. "3de68", "3bbb0", "39624")</label><br>
            <input class="FORMbsr" type="text" id="bsrId" name="bsrId" maxlength=5 minlength=5 pattern="[0123456789abcdefABCDEF]{5}"><br><br>

            <label class="FORMname" for="name">Pack/Mapper Name</label><br>
            <input class="FORMname" type="text" id="name" name="name" maxlength=100 minlength=3 pattern="[a-Z]{5}"><br><br>

            <label class="FORMchardiff" for="charecteristic">Characteristic</label><br>
            <select class="FORMchardiff" id="charecteristic" name="charecteristic">
                <option value="Standard">Standard</option>
                <option value="One Saber">One Saber</option>
                <option value="No Arrows">No Arrows</option>
                <option value="360 Degree">360 Degree</option>
                <option value="90 Degree">90 Degree</option>
                <option value="Lawless">Lawless</option>
                <option value="Lightshow">Lightshow</option>
                <option value="Other">All</option>
            </select>

            <label class="FORMchardiff" for="difficulty">Difficulty</label><br>
            <select class="FORMchardiff" id="difficulty" name="difficulty">
                <option value="Easy">Easy</option>
                <option value="Normal">Normal</option>
                <option value="Hard">Hard</option>
                <option value="Expert">Expert</option>
                <option value="ExpertPlus">Expert+</option>
                <option value="Other">All</option>
            </select>

            <input type="submit" value="Submit" formenctype="application/x-www-form-urlencoded">
        </form>
        <p id="username">Not currently logged in. <br><br><a href="/api/auth/beatleader"><img src="/cdn/loginbl.png" width="200px" /></a></p>
    </div>
    <div id="countsContainer">
        <h1>Submission Counts</h1>
        <span>
            <p class="countLabel">Total Submissions</p>
            <p class="count" id="totalCount">0</p>
        </span>
        <div id="counts">
            <span>
                <p class="countLabel">Map of the Year</p>
                <p class="count" id="motyCount">0</p>
            </span>
            <span>
                <p class="countLabel">Alternative Map</p>
                <p class="count" id="altCount">0</p>
            </span>
            <span>
                <p class="countLabel">Full Spread Map</p>
                <p class="count" id="fullspreadCount">0</p>
            </span>
            <span>
                <p class="countLabel">Lightshow</p>
                <p class="count" id="lightshowCount">0</p>
            </span>
            <span>
                <p class="countLabel">Modchart</p>
                <p class="count" id="modchartCount">0</p>
            </span>
            <span>
                <p class="countLabel">Art Map</p>
                <p class="count" id="artmapCount">0</p>
            </span>
            <span>
                <p class="countLabel">Ranked Map</p>
                <p class="count" id="rankedmapCount">0</p>
            </span>
            <span>
                <p class="countLabel">Balanced Map</p>
                <p class="count" id="balancedCount">0</p>
            </span>
            <span>
                <p class="countLabel">Tech Map</p>
                <p class="count" id="techCount">0</p>
            </span>
            <span>
                <p class="countLabel">Speed Map</p>
                <p class="count" id="speedCount">0</p>
            </span>
            <span>
                <p class="countLabel">Dance Map</p>
                <p class="count" id="danceCount">0</p>
            </span>
            <span>
                <p class="countLabel">Fitness Map</p>
                <p class="count" id="fitnessCount">0</p>
            </span>
            <span>
                <p class="countLabel">Challenge Map</p>
                <p class="count" id="challengeCount">0</p>
            </span>
            <span>
                <p class="countLabel">Acc Map</p>
                <p class="count" id="accCount">0</p>
            </span>
            <span>
                <p class="countLabel">Poodle Map</p>
                <p class="count" id="poodleCount">0</p>
            </span>
        </div>
    </div>
    <script>
        window.onload = async function checkSignedIn() {
            const auth = await fetch('/api/auth', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            if (auth.status !== 200) {
                //commit this line out when working on the page
                //window.location.href = '/api/auth/beatleader';
                document.getElementById('nominationForm').style.display = 'none';
            } else {
                const data = await auth.json();
                const element = document.getElementById('username');
                element.innerHTML = `Logged in as <a class="username" href="https://beatleader.xyz/u/${data.userId}">${data.username}</a>`;
            }
        }

        const NominationCategory = {
            OST: [`Gen-OST`, `OST`],
            PackOfTheYear: [`OTY-Pack`, "Pack of the Year"],
            MapOfTheYear: [`OTY-Map`, "Map of the Year"],
            MapperOfTheYear: [`OTY-Mapper`, "Mapper of the Year"],
            LighterOfTheYear: [`OTY-Lighter`, "Lighter of the Year"],
            RookieMapperOfTheYear: [`OTY-RookieMapper`, "Rookie Mapper of the Year"],
            RookieLighterOfTheYear: [`OTY-RookieLighter`, "Rookie Lighter of the Year"],
            AlternativeMap: [`Gen-Alternative`, "Non-Standard"],
            FullSpreadMap: [`Gen-FullSpread`, "Full Spread"],
            Lightshow: [`Mods-Lightshow`, "Lightshow"],
            Modchart: [`Mods-Modchart`, "Modchart"],
            ArtMap: [`Mods-ArtMap`, "Art Map"],
            RankedMap: [`Ranked-RankedMap`, "Ranked Map"],
            BalancedMap: [`Style-Balanced`, "Balanced"],
            TechMap: [`Style-Tech`, "Tech"],
            SpeedMap: [`Style-Speed`, "Speed"],
            DanceMap: [`Style-Dance`, "Dance"],
            FitnessMap: [`Style-Fitness`, "Fitness"],
            ChallengeMap: [`Style-Challenge`, "Challenge"],
            AccMap: [`Style-Acc`, "Acc"],
            PoodleMap: [`Style-Poodle`, "Poodle"],
        };

        // Get the form element
        const selectTag = document.getElementById('category');

        // Generate the category options
        for (const category in NominationCategory) {
            const option = document.createElement('option');
            option.value = NominationCategory[category][0];
            option.innerHTML = NominationCategory[category][1];

            selectTag.appendChild(option);
        }

        function onChange() {
            const category = document.getElementById('category').value;

            const charecteristic = document.getElementById('charecteristic');
            const difficulty = document.getElementById('difficulty');
            if (category == "Gen-FullSpread" || category == "OTY-Map"  || category == "OTY-Pack") {
                toggleCharDiff(false, false);
            } else if (category == "OTY-Pack" || category == "OTY-Mapper" || category == "OTY-Lighter" || category == "OTY-RookieMapper" || category == "OTY-RookieLighter") {
                toggleCharDiff(false, true);
            } else {
                toggleCharDiff(true, false);
            }
        }
        onChange();

        function toggleCharDiff(showDiffChar, showName) {
            const charecteristic = document.getElementById('charecteristic');
            const difficulty = document.getElementById('difficulty');
            const bsrId = document.getElementById('bsrId');
            const name = document.getElementById('name');
            if (show) {
                document.getElementsByClassName('FORMchardiff').forEach(element => {
                    element.style.display = 'block';
                });
                charecteristic.disabled = false;
                difficulty.disabled = false;
            } else {
                document.getElementsByClassName('FORMchardiff').forEach(element => {
                    element.style.display = 'none';
                });
                charecteristic.value = "Other";
                charecteristic.disabled = true;
                difficulty.value = "Other";
                difficulty.disabled = true;
            }

            if (showName) {
                document.getElementsByClassName('FORMbsr').forEach(element => {
                    element.style.display = 'none';
                });
                document.getElementsByClassName('FORMname').forEach(element => {
                    element.style.display = 'block';
                });
                bsrId.value = "";
                name.value = "";
            } else {
                document.getElementsByClassName('FORMbsr').forEach(element => {
                    element.style.display = 'Block';
                });
                document.getElementsByClassName('FORMname').forEach(element => {
                    element.style.display = 'none';
                });
                bsrId.value = "";
                name.value = "";
            }
        }

        function updateCounts() {
            fetch('/api/counts', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            }).then(response => response.json())
                .then(data => {
                    document.getElementById('totalCount').innerHTML = data.Total;
                    document.getElementById('motyCount').innerHTML = data.MapOfTheYear;
                    document.getElementById('altCount').innerHTML = data.AlternativeMap;
                    document.getElementById('fullspreadCount').innerHTML = data.FullSpreadMap;
                    document.getElementById('lightshowCount').innerHTML = data.Lightshow;
                    document.getElementById('modchartCount').innerHTML = data.Modchart;
                    document.getElementById('artmapCount').innerHTML = data.ArtMap;
                    document.getElementById('rankedmapCount').innerHTML = data.RankedMap;
                    document.getElementById('balancedCount').innerHTML = data.BalancedMap;
                    document.getElementById('techCount').innerHTML = data.TechMap;
                    document.getElementById('speedCount').innerHTML = data.SpeedMap;
                    document.getElementById('danceCount').innerHTML = data.DanceMap;
                    document.getElementById('fitnessCount').innerHTML = data.FitnessMap;
                    document.getElementById('challengeCount').innerHTML = data.ChallengeMap;
                    document.getElementById('accCount').innerHTML = data.AccMap;
                    document.getElementById('poodleCount').innerHTML = data.PoodleMap;
                });
        }
        setInterval(updateCounts, 60000);
        updateCounts();
    </script>
    <footer>
        <p class="footer">Created by <a class="footer" href="https://saeraphinx.dev">Saeraphinx</a></p>
    </footer>
</body>

</html>